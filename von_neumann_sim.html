<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura de Von Neumann - Simplificado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .register-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 5px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .register-box.active {
            background: #fff3cd;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .register-name {
            font-weight: bold;
            color: #333;
        }

        .register-value {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            color: #764ba2;
            font-weight: bold;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            background: white;
            padding: 15px;
            border-radius: 10px;
        }

        .memory-cell {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .memory-cell.active {
            background: #ffc107;
            border-color: #ff9800;
            transform: scale(1.1);
        }

        .memory-addr {
            color: #667eea;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .memory-data {
            color: #333;
            font-weight: bold;
        }

        .controls {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #fdcb6e;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        .status {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .output-section {
            grid-column: 1 / -1;
            background: #e8f5e9;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #4caf50;
        }

        .output-section h2 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .output-display {
            background: white;
            padding: 15px;
            border-radius: 10px;
            min-height: 80px;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            color: #2e7d32;
        }

        .input-section {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #ff9800;
        }

        .input-section input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff9800;
            border-radius: 8px;
            font-size: 1.1em;
            font-family: 'Courier New', monospace;
        }

        .input-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #e65100;
        }

        .program-list {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .program-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
            color: #1a1a2e;
            padding: 10px 20px;
            font-size: 0.95em;
        }

        .explanation {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 5px solid #2196f3;
        }

        .explanation h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #333;
            line-height: 1.6;
        }

        .step-indicator {
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏è Arquitectura de Von Neumann</h1>
        <p class="subtitle">Versi√≥n Simplificada y F√°cil de Entender</p>
        
        <div class="main-layout">
            <!-- CPU -->
            <div class="section">
                <h2>‚öôÔ∏è CPU (Cerebro)</h2>
                
                <div class="register-box" id="pc-box">
                    <span class="register-name">PC (Siguiente Instrucci√≥n)</span>
                    <span class="register-value" id="pc">0</span>
                </div>
                
                <div class="register-box" id="ir-box">
                    <span class="register-name">IR (Instrucci√≥n Actual)</span>
                    <span class="register-value" id="ir">---</span>
                </div>
                
                <div class="register-box" id="acc-box">
                    <span class="register-name">ACC (Resultado)</span>
                    <span class="register-value" id="acc">0</span>
                </div>

                <div class="explanation">
                    <h3>¬øQu√© hace la CPU?</h3>
                    <p>Lee instrucciones de la memoria y las ejecuta una por una. Guarda resultados en el Acumulador (ACC).</p>
                </div>
            </div>

            <!-- Memoria -->
            <div class="section">
                <h2>üíæ Memoria (Almacenamiento)</h2>
                <div class="memory-grid" id="memory"></div>
                
                <div class="explanation">
                    <h3>¬øQu√© contiene?</h3>
                    <p>Guarda las instrucciones del programa y los datos. Cada celda tiene una direcci√≥n (0, 1, 2...) y un contenido.</p>
                </div>
            </div>

            <!-- Controles -->
            <div class="controls">
                <h2 style="text-align: center; color: #333; margin-bottom: 15px;">üìã Programas Disponibles</h2>
                
                <div class="program-list">
                    <button class="program-btn" onclick="loadProgram1()">‚ûï Suma Simple</button>
                    <button class="program-btn" onclick="loadProgram2()">‚úñÔ∏è Sumar 2 N√∫meros</button>
                    <button class="program-btn" onclick="loadProgram3()">‚ûñ Resta</button>
                    <button class="program-btn" onclick="loadProgram4()">üî¢ Entrada Usuario</button>
                </div>

                <div class="step-indicator" id="step">Paso: ---</div>

                <div class="button-group">
                    <button onclick="executeStep()">‚ñ∂Ô∏è Siguiente Paso</button>
                    <button onclick="executeAll()">üöÄ Ejecutar Todo</button>
                    <button onclick="reset()">üîÑ Reiniciar</button>
                </div>

                <div class="status" id="status">Selecciona un programa para comenzar</div>
            </div>

            <!-- Salida -->
            <div class="output-section">
                <h2>üì§ Salida (Pantalla)</h2>
                <div class="output-display" id="output">Esperando resultados...</div>

                <div class="input-section">
                    <label>üì• Entrada (para programas interactivos):</label>
                    <input type="number" id="input-field" placeholder="Escribe un n√∫mero y presiona Enter">
                </div>
            </div>
        </div>
    </div>

    <script>
        let memory = [];
        let pc = 0;
        let ir = '';
        let acc = 0;
        let waiting = false;
        let currentStep = 0;

        function initMemory() {
            memory = new Array(16).fill('0');
            displayMemory();
        }

        function displayMemory() {
            const memDiv = document.getElementById('memory');
            memDiv.innerHTML = '';
            for (let i = 0; i < memory.length; i++) {
                const cell = document.createElement('div');
                cell.className = 'memory-cell';
                cell.id = 'mem-' + i;
                cell.innerHTML = `
                    <span class="memory-addr">[${i}]</span>
                    <span class="memory-data">${memory[i]}</span>
                `;
                memDiv.appendChild(cell);
            }
        }

        function updateDisplay() {
            document.getElementById('pc').textContent = pc;
            document.getElementById('ir').textContent = ir || '---';
            document.getElementById('acc').textContent = acc;
        }

        function highlight(id, duration = 800) {
            const elem = document.getElementById(id);
            elem.classList.add('active');
            setTimeout(() => elem.classList.remove('active'), duration);
        }

        function setStatus(msg) {
            document.getElementById('status').textContent = msg;
        }

        function setStep(step) {
            currentStep = step;
            const steps = ['FETCH (Buscar)', 'DECODE (Entender)', 'EXECUTE (Hacer)'];
            document.getElementById('step').textContent = `Paso ${step}: ${steps[step - 1] || '---'}`;
        }

        // PROGRAMA 1: Suma simple (5 + 3)
        function loadProgram1() {
            reset();
            memory = [
                'LOAD 5',    // 0
                'ADD 3',     // 1
                'OUT',       // 2
                'HALT',      // 3
                '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'
            ];
            displayMemory();
            setStatus('‚úÖ Programa cargado: Suma 5 + 3');
            document.getElementById('output').innerHTML = 
                '<strong>Programa:</strong><br>' +
                '1. Cargar 5<br>' +
                '2. Sumar 3<br>' +
                '3. Mostrar resultado<br><br>' +
                '<strong>Resultado esperado: 8</strong>';
        }

        // PROGRAMA 2: Sumar dos n√∫meros de memoria
        function loadProgram2() {
            reset();
            memory = [
                'LOAD 10',   // 0
                'STORE 8',   // 1
                'LOAD 15',   // 2
                'ADD 8',     // 3
                'OUT',       // 4
                'HALT',      // 5
                '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'
            ];
            displayMemory();
            setStatus('‚úÖ Programa cargado: Suma 10 + 15');
            document.getElementById('output').innerHTML = 
                '<strong>Programa:</strong><br>' +
                '1. Cargar 10<br>' +
                '2. Guardar en memoria<br>' +
                '3. Cargar 15<br>' +
                '4. Sumar con el 10<br>' +
                '5. Mostrar resultado<br><br>' +
                '<strong>Resultado esperado: 25</strong>';
        }

        // PROGRAMA 3: Resta
        function loadProgram3() {
            reset();
            memory = [
                'LOAD 20',   // 0
                'SUB 7',     // 1
                'OUT',       // 2
                'HALT',      // 3
                '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'
            ];
            displayMemory();
            setStatus('‚úÖ Programa cargado: Resta 20 - 7');
            document.getElementById('output').innerHTML = 
                '<strong>Programa:</strong><br>' +
                '1. Cargar 20<br>' +
                '2. Restar 7<br>' +
                '3. Mostrar resultado<br><br>' +
                '<strong>Resultado esperado: 13</strong>';
        }

        // PROGRAMA 4: Con entrada del usuario
        function loadProgram4() {
            reset();
            memory = [
                'INPUT',     // 0
                'STORE 8',   // 1
                'INPUT',     // 2
                'ADD 8',     // 3
                'OUT',       // 4
                'HALT',      // 5
                '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'
            ];
            displayMemory();
            setStatus('‚úÖ Programa cargado: Suma dos n√∫meros que t√∫ ingresas');
            document.getElementById('output').innerHTML = 
                '<strong>Programa Interactivo:</strong><br>' +
                '1. Pedir primer n√∫mero<br>' +
                '2. Guardar en memoria<br>' +
                '3. Pedir segundo n√∫mero<br>' +
                '4. Sumar ambos<br>' +
                '5. Mostrar resultado<br><br>' +
                '<strong>‚å®Ô∏è Escribe los n√∫meros abajo cuando se pidan</strong>';
        }

        async function executeStep() {
            if (pc >= memory.length || memory[pc] === 'HALT' || memory[pc] === '0') {
                setStatus('üèÅ Programa terminado');
                setStep(0);
                return;
            }

            // FETCH
            setStep(1);
            ir = memory[pc];
            highlight('mem-' + pc);
            highlight('pc-box');
            highlight('ir-box');
            setStatus(`üîç FETCH: Leyendo instrucci√≥n "${ir}" desde posici√≥n ${pc}`);
            updateDisplay();
            await sleep(800);

            pc++;
            updateDisplay();

            // DECODE
            setStep(2);
            setStatus(`üîß DECODE: Interpretando "${ir}"`);
            await sleep(800);

            // EXECUTE
            setStep(3);
            await executeInstruction(ir);
            await sleep(800);

            setStep(0);
        }

        async function executeInstruction(instruction) {
            const parts = instruction.split(' ');
            const op = parts[0];
            const value = parts[1];

            highlight('acc-box');

            switch(op) {
                case 'LOAD':
                    if (value.match(/^\d+$/)) {
                        acc = parseInt(value);
                        setStatus(`‚ö° EXECUTE: Cargar ${value} ‚Üí ACC = ${acc}`);
                    } else {
                        const addr = parseInt(value);
                        acc = parseInt(memory[addr]);
                        highlight('mem-' + addr);
                        setStatus(`‚ö° EXECUTE: Cargar desde memoria[${addr}] ‚Üí ACC = ${acc}`);
                    }
                    break;

                case 'ADD':
                    if (value.match(/^\d+$/)) {
                        const oldAcc = acc;
                        acc += parseInt(value);
                        setStatus(`‚ö° EXECUTE: ${oldAcc} + ${value} = ${acc}`);
                    } else {
                        const addr = parseInt(value);
                        const oldAcc = acc;
                        acc += parseInt(memory[addr]);
                        highlight('mem-' + addr);
                        setStatus(`‚ö° EXECUTE: ${oldAcc} + memoria[${addr}] = ${acc}`);
                    }
                    break;

                case 'SUB':
                    const oldAcc = acc;
                    acc -= parseInt(value);
                    setStatus(`‚ö° EXECUTE: ${oldAcc} - ${value} = ${acc}`);
                    break;

                case 'STORE':
                    const addr = parseInt(value);
                    memory[addr] = acc.toString();
                    highlight('mem-' + addr);
                    displayMemory();
                    setStatus(`‚ö° EXECUTE: Guardar ACC (${acc}) en memoria[${addr}]`);
                    break;

                case 'OUT':
                    document.getElementById('output').innerHTML += `<br>üì§ <strong>RESULTADO: ${acc}</strong>`;
                    setStatus(`‚ö° EXECUTE: Mostrar resultado: ${acc}`);
                    break;

                case 'INPUT':
                    setStatus('‚å®Ô∏è Esperando que ingreses un n√∫mero...');
                    const input = await waitForInput();
                    acc = parseInt(input);
                    document.getElementById('output').innerHTML += `<br>üì• Ingresaste: ${acc}`;
                    setStatus(`‚ö° EXECUTE: N√∫mero ingresado: ${acc}`);
                    break;

                case 'HALT':
                    setStatus('üõë HALT: Programa terminado');
                    pc = 999;
                    break;
            }

            updateDisplay();
        }

        function waitForInput() {
            return new Promise((resolve) => {
                const input = document.getElementById('input-field');
                const handler = (e) => {
                    if (e.key === 'Enter' && input.value.trim() !== '') {
                        const value = input.value.trim();
                        input.value = '';
                        input.removeEventListener('keypress', handler);
                        resolve(value);
                    }
                };
                input.addEventListener('keypress', handler);
                input.focus();
            });
        }

        async function executeAll() {
            while (pc < memory.length && memory[pc] !== 'HALT' && memory[pc] !== '0') {
                await executeStep();
                await sleep(200);
            }
        }

        function reset() {
            pc = 0;
            ir = '';
            acc = 0;
            currentStep = 0;
            initMemory();
            updateDisplay();
            setStep(0);
            setStatus('Sistema reiniciado');
            document.getElementById('output').textContent = 'Esperando resultados...';
            document.getElementById('input-field').value = '';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Inicializar
        initMemory();
        updateDisplay();
    </script>
</body>
</html>